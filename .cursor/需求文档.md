# 智能充电站管理系统软件需求文档

## 引言 (Introduction)

### 目的 (Purpose)

本文档旨在详细定义“智能充电站管理系统”的功能性与非功能性需求。本文档将作为项目团队进行系统设计、开发、测试及最终验收的主要依据。

### 项目范围 (Scope)

本系统是一个集成了用户客户端、管理员客户端和后台服务器的综合性充电管理平台。它旨在自动化和优化电动车充电流程，包括排队、调度、充电、计费和监控，以提升充电效率和用户体验。

### 定义、首字母缩写词和缩略语 (Definitions, Acronyms, and Abbreviations)

* **充电区**: 部署了充电桩，车辆进行充电的物理区域。
* **等候区**: 车辆在进入充电区前排队等待的物理区域。
* **快充桩**: High-power charging pile. 功率为 30 度/小时。
* **慢充桩**: Low-power charging pile. 功率为 7 度/小时。
* **排队号码**: 系统为用户的充电请求生成的唯一标识，分为 F (快充) 和 T (慢充) 两种类型。
* **调度策略**: 系统将等候区车辆分配至充电桩队列的算法规则。
* **SRS**: Software Requirements Specification (软件需求规格说明书)。

## 总体描述 (Overall Description)

### 产品愿景 (Product Perspective)

本产品是一个独立的智能化管理系统，由三个主要部分构成：

1. **用户客户端 (User Client)**: 供电动车主使用，进行充电请求、状态查询、费用支付等操作。
2. **管理员客户端 (Admin Client)**: 供充电站工作人员使用，进行充电桩监控、系统管理和报表查看。
3. **服务器端 (Server)**: 系统的核心，负责处理所有业务逻辑，包括排队管理、智能调度、计费、数据存储和接口服务。

### 系统角色 (System Actors)

* **用户 (电动车主)**:
  * 注册登录系统。
  * 提交、修改或取消充电请求。
  * 实时查看自己的排队位置和预计等待情况。
  * 查看充电过程中的详细信息及历史充电详单。
* **管理员 (充电站工作人员)**:
  * 监控和管理所有充电桩的运行状态。
  * 查看当前在充电和排队的车辆信息。
  * 生成和查看运营统计报表。
  * 处理系统中的特殊事件（如设备故障）。

### 主要限制与假设 (General Constraints and Assumptions)

* **物理布局**: 充电站包含一个充电区和一个等候区。
* **硬件假定**: 充电桩硬件接口稳定，能准确上报充电数据和状态。
* **网络**: 系统各组件之间需保持稳定可靠的网络连接。

## 核心实体与业务规则 (Core Entities & Business Rules)**

### 核心实体 (Core Entities)

* **充电区**:
  * 包含 **2** 个快充电桩 (A, B)。
  * 包含 **3** 个慢充电桩 (C, D, E)。
* **等候区**:
  * 最大车位容量为 **6**。
* **充电桩**:
  * **快充桩**: 功率为 **30 度/小时**。
  * **慢充桩**: 功率为 **7 度/小时**。
  * 每个充电桩拥有一个独立的排队队列，队列长度为 **2** (包含1个正在充电的车位和1个等待车位)。
* **充电请求**:
  * 包含充电模式（快充/慢充）和请求充电量（度）。

### 排队规则

* **号码生成**:
  * 用户提交充电请求后，系统根据模式分配排队号码。
  * 快充模式：号码以 'F' 开头，后跟顺序数字 (F1, F2, ...)。
  * 慢充模式：号码以 'T' 开头，后跟顺序数字 (T1, T2, ...)。
* **叫号规则**:
  * 当任一充电桩队列出现空位时，系统将从等候区叫号。
  * 叫号遵循“先来先到”原则，即按排队号码顺序 (F1->F2..., T1->T2... )。
  * 叫号车辆必须与充电桩模式匹配（快充桩叫F号，慢充桩叫T号）。

### 标准调度策略

* **目标**: 最小化被调度车辆的**总完成时间**。
* **公式**: `总完成时间 = 等待时间 + 自身充电时间`
* **定义**:
  * **等待时间**: 目标充电桩队列中，所有前方车辆完成充电所需的总时间。
  * **自身充电时间**: `用户请求充电量 / 充电桩功率`。
* **流程**: 当一辆车（如 F1）被叫号时，系统会计算它进入所有可用的匹配类型充电桩（如 A 和 B）的总完成时间，并将其分配到时间最短的那个桩。

### 计费规则

* **总费用**: `总费用 = 充电费 + 服务费`
* **充电费**: `充电费 = 单位电价 * 实际充电度数`
* **服务费**: `服务费 = 服务费单价 * 实际充电度数`
* **服务费单价**: **0.8 元/度**。
* **单位电价 (分时电价)**:
  * **峰时**: **1.0 元/度** (10:00–15:00, 18:00–21:00)
  * **平时**: **0.7 元/度** (07:00–10:00, 15:00–18:00, 21:00–23:00)
  * **谷时**: **0.4 元/度** (23:00–次日07:00)

## 功能性需求 (Functional Requirements)

### 用户客户端功能

1. **用户认证**: 提供注册和登录功能。
2. **提交充电请求**:
    * 用户可选择“快充”或“慢充”模式。
    * 用户需输入本次请求的充电量（单位：度）。
3. **查看排队状态**:
    * 显示本车的排队号码。
    * 显示在本车充电模式下，前方等待的车辆数量。
4. **修改充电请求**:
    * **在等候区**:
        * 允许修改充电模式。修改后，原号码作废，生成新模式队列末位的新号码。
        * 允许修改请求充电量，排队号码不变。
    * **在充电区**:
        * 不允许修改任何请求信息。
5. **取消充电请求**:
    * 在等候区或充电区，用户均可随时发起“取消充电”或“结束充电”的请求。
6. **查看充电详单**:
    * 用户可查看自己的历史充电记录。
    * 详单必须至少包含：详单编号、生成时间、充电桩编号、充电电量、充电时长、启动时间、停止时间、充电费用、服务费用、总费用。

### 管理员客户端功能

1. **充电桩管理**:
    * 管理员可远程“启动”或“关闭”任意一个充电桩。
2. **状态监控**:
    * **充电桩状态**: 实时查看所有充电桩的当前状态（正常、故障、关闭）、系统启动后的累计充电次数、累计充电总时长、累计充电总电量。
    * **服务车辆信息**: 查看正在各充电桩排队或充电的车辆信息，包括用户ID、车辆电池总容量、本次请求充电量、已排队时长。
3. **报表系统**:
    * 可按日、周、月生成运营报表。
    * 报表需包含各充电桩的累计充电次数、累计充电时长、累计充电量、累计充电费用、累计服务费用、累计总费用。

### 服务器核心功能

1. **排队管理**:
    * 接收用户的充电请求，验证后生成唯一的排队号码并加入相应队列。
    * 管理等候区和各充电桩队列，确保数据准确。
2. **调度执行**:
    * 实时监控充电桩队列状态，一旦出现空位立即触发叫号和调度逻辑。
    * 根据 3.3 节定义的标准调度策略，将车辆分配至最优充电桩。
3. **计费与订单生成**:
    * 在充电结束时（正常完成、用户取消或故障中断），根据 3.4 节的计费规则精确计算费用。
    * 生成包含所有必要字段的充电详单。
4. **数据管理**:
    * 持久化存储用户信息、充电桩信息、充电请求、排队信息和历史详单。
    * 提供数据统计和聚合功能，以支持管理员的报表需求。
5. **充电桩监控**:
    * 与充电桩硬件交互，获取实时状态和充电数据。
    * 记录充电桩的运行日志。

## 特殊场景处理 (Special Scenarios Handling)

### 充电桩故障处理

当一个正在服务的充电桩发生故障时，系统需按以下预设策略之一进行处理：

* **正在充电的车辆**: 立即停止计费，为本次未完成的充电生成一笔详单。
* **故障桩队列中的车辆**: 对队列中等待的车辆进行重新调度。
  * **优先级调度**: 暂停整个等候区的叫号服务。当同类型其他正常充电桩出现空位时，**优先**为故障桩队列中的车辆进行调度。待故障桩队列全部清空后，恢复等候区的正常叫号。
  * **时间顺序调度**: 暂停整个等候区的叫号服务。将故障桩队列中的车辆与同类型其他正常桩队列中尚未充电的车辆**合并为一组**，按原排队号码的先后顺序重新进行调度。调度完毕后，恢复等候区叫号。
* **故障恢复**: 当故障桩恢复正常后，若同类型其他桩仍有车辆排队，则暂停叫号，将这些车与恢复正常的桩进行统一的合并调度（类似b策略），完成后恢复正常叫号。

## 扩展调度需求 (Optional Advanced Scheduling)

### 单次调度总时长最短 (Minimize Batch Completion Time)

* **触发条件**: 当某种模式的充电桩出现 M 个空位时，系统可从等候区按顺序一次性叫号 N 辆车 (N ≤ M)。
* **调度逻辑**: 这 N 辆车进入充电区后，不再遵循个体最优，而是进行“统一调度”。系统需要计算所有可能的分配方式，找出一种分配方案，使得这 N 辆车**完成充电的总时长（所有车累计等待时间 + 所有车累计充电时间）最短**。

### 批量调度总时长最短 (Minimize Full-Batch Completion Time)

* **触发条件**: 当到达充电站的车辆总数等于充电区车位总数（示例中为10个，但应为可配置参数）时，触发一次批量调度。
* **调度逻辑**:
    1. **忽略充电模式**: 所有车辆均可被分配至任意类型的充电桩（快充或慢充）。
    2. **统一调度**: 系统需计算最优分配方案，使得这**一批所有车辆完成充电的总时长（所有车累计等待时间 + 所有车累计充电时间）最短**。

## 非功能性需求 (Non-Functional Requirements)

### 可配置性 (Configurability)

系统应提供在后台或配置文件中对以下核心参数进行设置的能力，而无需修改代码：

* 快充电桩数量 (`FastChargingPileNum`)
* 慢充电桩数量 (`TrickleChargingPileNum`)
* 等候区车位容量 (`WaitingAreaSize`)
* 充电桩排队队列长度 (`ChargingQueueLen`)

### 可靠性 (Reliability)

* 系统应能7x24小时不间断运行。
* 具备对充电桩故障的自动检测和处理能力，如 5.1 节所述。
* 数据库应有备份和恢复机制，防止数据丢失。

### 性能 (Performance)

* 用户客户端的请求响应时间应在2秒以内。
* 服务器端的调度算法必须高效，确保在充电桩出现空位后能立即完成计算并发出调度指令。

### 易用性 (Usability)

* 用户和管理员界面应直观、美观，易于理解和操作。
* 关键信息（如排队位置、费用、桩状态）需清晰展示。
